<!DOCTYPE html>
<html lang="ko"
	  xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{common/layout}">
<head layout:fragment="ConfigFrament">

</head>

<body>
	<header layout:fragment="HeaderFragment"></header>

		<section class="sub_content">
			<div class="sub_top_box">
				<div class="container">
					<div class="row">
						<div class="col">
							<h3 class="fw_pb ft_s4">대회신청 및 안내</h3>
							<p class="f_s1 fw_pl f_s3">국민의 사랑을 받는 스포츠로 발전할 수 있도록 노력하고 앞장서겠습니다.</p>
						</div>
					</div>
				</div>
			</div>

			<div class="sub_top_text">
				<div class="container">
					<div class="row">
						<div class="col">
							<p class="f_s1"><span><img src="/assets/img/home.png"></span> 대회신청</p>
						</div>
					</div>
				</div>
			</div>

			<div class="sub_content_box">
				<form name="frm" onsubmit="return checkForm()" th:action="@{/competitions/{id}/apply(id=${competition.id})}" method="post">
					<div class="container mb_20">
						<div class="row kors_list_ui_box">
							<div class="col">
								<div class="kors_list_ui1 more_type">
									<ul>
										<li>
											<div class="text_box">
												<h4 class="list_title ft_s0 fw_pm" th:text="${competition.competitionName}"></h4>

												<div class="text_list1">
													<dl class="d-flex">
														<dt class="f_c_active">기간</dt>
														<dd class="f_c_g1" th:text="${competition.competitionApplyStartDate + ' ~ ' + competition.competitionApplyEndDate}"></dd>
													</dl>
												</div>
											</div>
										</li>
									</ul>
								</div>
								<div class="more_content_box">
									<div>
										<div class="mb_40">
											<p class="ft_s0">개인 경기선택 <span class="f_s2 f_c_active">(최대 2개)</span></p>
											<ul>
												<!-- 남자 -->
												<i><li class="ft_s1 mb_10" style="margin-top: 20px; font-weight: bold " th:text="'> ' + 남자"></li></i>
												<li class="f_s4" th:each="event : ${eventList}">
													<p class="f_s3 mb_10" th:text="${event.eventType}"></p>
													<p class="f_s1 mb_10" th:each="competitionEvent, index : ${competitionEventList}" th:if="${#strings.substringBefore(competitionEvent.eventType, '_').equals('INDIVIDUAL') && competitionEvent.event().equals(event.eventType) && competitionEvent.gender.equals('M')}">
														<input type="checkbox" th:id="'competitionEvent_' + ${index.count}" name="individualCompetitionEventIds" th:value="${competitionEvent.id}" class="d-none"/>
														<label class="checkbox_style1" th:for="'competitionEvent_' + ${index.count}" th:text="${competitionEvent.department} + ' ' + ${#strings.substringBefore(competitionEvent.eventType, '_').equals('ORGANIZATION') ? '단체' : '개인'}+' ' + ${competitionEvent.meter}"></label>
													</p>
													<hr />
												</li>
												<!-- 여자 -->
												<i><li class="ft_s1 mb_10" style="margin-top: 20px; font-weight: bold" th:text="'> ' + 여자"></li></i>
												<li class="f_s4" th:each="event : ${eventList}">
													<p class="f_s3 mb_10" th:text="${event.eventType}"></p>
													<p class="f_s1 mb_10" th:each="competitionEvent, index : ${competitionEventList}" th:if="${#strings.substringBefore(competitionEvent.eventType, '_').equals('INDIVIDUAL') && competitionEvent.event().equals(event.eventType) && competitionEvent.gender.equals('F')}">
														<input type="checkbox" th:id="'competitionEvent_' + ${index.count}" name="individualCompetitionEventIds" th:value="${competitionEvent.id}" class="d-none"/>
														<label class="checkbox_style1" th:for="'competitionEvent_' + ${index.count}" th:text="${competitionEvent.department} + ' ' + ${#strings.substringBefore(competitionEvent.eventType, '_').equals('ORGANIZATION') ? '단체' : '개인'}+' ' + ${competitionEvent.meter}"></label>
													</p>
													<hr />
												</li>
<!--												<input type="hidden" name="competitionSeq" th:value="${competition.id}" id="competition_seq" class="d-none"/>-->
												<input type="hidden" name="userId" id="user_seq" th:value="1" class="d-none"/>
											</ul>
										</div>

										<div class="mb_40">
											<p class="ft_s0 mb_20">단체 경기선택 <span class="f_s2 f_c_active">(전체 팀원중 한명만 신청 해 주십시오.)</span></p>
											<ul>
												<!-- 혼성 -->
												<i><li class="ft_s1 mb_10" style="margin-top: 20px; font-weight: bold" th:text="'> ' + 혼성"></li></i>
												<li class="f_s4" th:each="event : ${eventList}">
													<p class="f_s3 mb_10" th:text="${event.eventType}"></p>
													<p class="f_s1 mb_10" th:each="competitionEvent, index : ${competitionEventList}" th:if="${#strings.substringBefore(competitionEvent.eventType, '_').equals('ORGANIZATION') && competitionEvent.event().equals(event.eventType) && competitionEvent.gender.equals('X')}">
														<input type="checkbox" th:id="'competitionEvent_' + ${index.count}" name="organizationCompetitionEventIds" th:value="${competitionEvent.id}" class="d-none"/>
														<label class="checkbox_style1" th:for="'competitionEvent_' + ${index.count}" th:text="${competitionEvent.department} + ' ' + ${#strings.substringBefore(competitionEvent.eventType, '_').equals('ORGANIZATION') ? '단체' : '개인'}+' ' + ${competitionEvent.meter}"></label>
													</p>
													<hr />
												</li>
												<!-- 남자 -->
												<i><li class="ft_s1 mb_10" style="margin-top: 20px; font-weight: bold" th:text="'> ' + 남자"></li></i>
												<li class="f_s4" th:each="event : ${eventList}">
													<p class="f_s3 mb_10" th:text="${event.eventType}"></p>
													<p class="f_s1 mb_10" th:each="competitionEvent, index : ${competitionEventList}" th:if="${#strings.substringBefore(competitionEvent.eventType, '_').equals('ORGANIZATION') && competitionEvent.event().equals(event.eventType) && competitionEvent.gender.equals('M')}">
														<input type="checkbox" th:id="'competitionEvent_' + ${index.count}" name="organizationCompetitionEventIds" th:value="${competitionEvent.id}" class="d-none"/>
														<label class="checkbox_style1" th:for="'competitionEvent_' + ${index.count}" th:text="${competitionEvent.department} + ' ' + ${#strings.substringBefore(competitionEvent.eventType, '_').equals('ORGANIZATION') ? '단체' : '개인'}+' ' + ${competitionEvent.meter}"></label>
													</p>
													<hr />
												</li>
												<!-- 여자 -->
												<i><li class="ft_s1 mb_10" style="margin-top: 20px; font-weight: bold" th:text="'> ' + 여자"></li></i>
												<li class="f_s4" th:each="event : ${eventList}">
													<p class="f_s3 mb_10" th:text="${event.eventType}"></p>
													<p class="f_s1 mb_10" th:each="competitionEvent, index : ${competitionEventList}" th:if="${#strings.substringBefore(competitionEvent.eventType, '_').equals('ORGANIZATION') && competitionEvent.event().equals(event.eventType) && competitionEvent.gender.equals('F')}">
														<input type="checkbox" th:id="'competitionEvent_' + ${index.count}" name="organizationCompetitionEventIds" th:value="${competitionEvent.id}" class="d-none"/>
														<label class="checkbox_style1" th:for="'competitionEvent_' + ${index.count}" th:text="${competitionEvent.department} + ' ' + ${#strings.substringBefore(competitionEvent.eventType, '_').equals('ORGANIZATION') ? '단체' : '개인'}+' ' + ${competitionEvent.meter}"></label>
													</p>
													<hr />
												</li>
<!--												<input type="hidden" th:field="*{teamSeq}" id="team_seq" class="d-none"/>-->
											</ul>
										</div>

<!--									TODO :: 로그인 한 유저의 소속 팀을 조회	-->
										<div class="mb_40">
											<p class="ft_s0 mb_20">소속팀 정보 선택<span class="f_s2 f_c_active">(단체 경기 참가시 입력)</span></p>
											<ul>
												<li class="mb_10">
<!--												<input type="text" id="teamName" placeholder="소속팀 이름" class="kors_input1">-->
													<select class="kors_selet1" name="teamId">
														<option value="" selected>팀을 선택해주세요</option>
														<option value="1">테스트 팀1</option>
														<option value="2">테스트 팀2</option>
														<option value="3">테스트 팀3</option>
													</select>
													<!--												<option th:each="team : ${teamList}" th:value="${team.id}" th:text="${team.teamName}"></option>-->
												</li>
												<li><button type="button" onclick="teamCheck();" id="check_team" class="kors_btn1">소속팀 확인</button></li>
											</ul>
										</div>

										<div>
											<p class="f_s4 mb_5">대회 참가비</p>
											<ul>
												<li th:text="${'성인 : ' + competition.competitionFee() + '원'}"></li>
												<li th:text="${'학생(만18세) : ' + competition.competitionStudentFee() + '원'}"></li>
												<br />
<!--												<li th:text="${competition.getPrice()}"></li>-->
												<li th:text="${competition.competitionAccount()}"></li>
											</ul>
										</div>
									</div>
								</div>
							</div>
						</div>

						<div class="row">
							<div class="col">
								<div class="more_page_btn">
									<button type="submit" class="mr_10 kors_btn primay">신청하기</button>
									<a href="/static">취소</a>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>
		</section>


		<script type="text/javascript">
			$(function(){
				let query = window.location.search;
				let param = new URLSearchParams(query);
				let isDone = param.get('isDone');

				if(isDone === "fail"){
					alert("대회 신청을 실패했습니다.");
				} else if(isDone === "error"){
					alert("성별에 맞는 대회를 선택해 주십시오.");
				}
				$("input:checkbox[name='individualCompetitionEventIds']").on("click", function (){
					let count = $("input:checked[name='individualCompetitionEventIds']").length;
					if(count > 2){
						$(this).prop("checked", false);
						alert("참가 종목은 2개 이상 선택할 수 없습니다.")
					}
				})
			});
		</script>
		<script type="text/javascript">
			// function userCheck(){
			// 	var userName = document.getElementById("name").value;
			// 	var userPwd = document.getElementById("pwd").value;
			// 	var competitionSeq = [[${competitionSeq}]]
			// 	$.ajax({
			// 		type: "GET",
			// 		url: "/admin/user/find/competition",
			// 		// async: false,
			// 		data: {userName : userName, password : userPwd, competitionSeq : competitionSeq},
			// 		error : function(request,status,error) {
			// 			alert("존재하지 않는 사용자 입니다.")
			// 			console.log("code:" + request.status + "\n" + "message:" + request.responseText + "\n" + "error:" + error);
			// 		},
			// 		success: function (data) {
			// 			if(data === "isExist"){
			// 				alert("이미 대회에 신청한 경기인입니다.")
			// 				location.reload();
			// 			}else{
			// 				alert("성공적으로 확인되었습니다.")
			// 				document.getElementById("user_seq").value = data;
			// 			}
			// 		}
			// 	});
			// }

			// function teamCheck(){
			// 	var teamName = document.getElementById("teamName").value;
			// 	var competitionSeq = [[${competitionSeq}]]
			// 	$.ajax({
			// 		type: "GET",
			// 		url: "/admin/team/find/application",
			// 		// async: false,
			// 		data: {teamName : teamName, competitionSeq : competitionSeq},
			// 		error : function(request,status,error) {
			// 			alert("존재하지 않는 소속팀 입니다.")
			// 			location.reload();
			// 		},
			// 		success: function (data) {
			// 			if(data === "isExist"){
			// 				alert("이미 대회에 신청한 소속팀입니다.")
			// 				location.reload();
			// 			}else{
			// 				alert("성공적으로 확인되었습니다.")
			// 				document.getElementById("team_seq").value = data;
			// 			}
			// 		}
			// 	});
			// }

			function checkForm() {

				if ($("input:checkbox[name='individualCompetitionEventIds']").is(":checked")==false && $("input:checkbox[name='individualCompetitionEventIds']").is(":checked")==false) {
					alert("종목을 선택해 주십시오.");
					return false;

				} else if($("input:checkbox[name='organizationCompetitionEventIds']").is(":checked")==true){
					if (frm.teamName.value == "") {
						frm.teamName.focus();
						alert("소속팀을 확인해 주십시오.");
						return false;
					}
				}
			}
		</script>

	<footer id="kors_footer">
		<div class="container-fluid f_s1 fw_pl">
			<div class="row footer_top justify-content-between row-cols-auto">
				<div class="col d-flex">
					<div class="logo_box">
						<h2>김해시수영연맹</h2>
					</div>
					<div class="text_box">
						<p><span class="f_c_w">사단법인 김해시수영연맹</span></p>
						<p>
							<span>경남 김해시 생림면 나전로 249번길 13-67</span>
						</p>
						<p>
							<span>회장 최성일 : 010-3865-6621</span>
							<span>부회장 : 김용태 010-9313-3644</span>
							<span>전무 : 조광제 010-8468-2213</span>
							<span>사무국장 : 김경태 010-3180-2367</span>
						</p>
						<p>
							<span>FAX : 055-323-9260</span>
							<span>email : khsw2019@naver.com</span>
						</p>
					</div>
				</div>
			</div>

			<div class="row footer_bottom">
				<div class="col d-flex justify-content-between">
					<p class="cop_text">Copyright © 2023 사단법인 김해시수영연맹(Gimhae Swimming Federation). All Rights Reserved. </p>
					<ul class="d-flex f-list">
						<li><a href="https://www.korswim.co.kr/page/privacy" style="color: #fff;">개인정보처리방침</a></li>
						<li><a href="https://www.korswim.co.kr/page/terms">이용약관</a></li>
						<li><a href="#null">이메일무단수집거부</a></li>
					</ul>
				</div>
			</div>
		</div>
	</footer>
	</body>
</html>